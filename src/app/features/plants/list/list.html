<table mat-table [dataSource]="species()" multiTemplateDataRows class="mat-elevation-z8">
	@for (column of columns(); track column) {
	<ng-container matColumnDef="{{ column }}">
		<th mat-header-cell *matHeaderCellDef>
			@switch (column) { @case ('plantType'){ Typ } @case ('variety'){ Sort } @case ('sowWindow'){ Såfönster }
			@case ('name'){ Namn } }
		</th>

		<td mat-cell *matCellDef="let row">
			@switch (column) { @case ('plantType'){ {{ row.plantType }} } @case ('variety'){ {{ row.variety }} } @case
			('sowWindow'){ {{ sowingWindowText(row) }} } @case ('name'){ {{ nameOf(row) }} } }
		</td>
	</ng-container>
	}

	<!-- EN (1) expandedDetail-kolumn -->

	<ng-container matColumnDef="expandedDetail">
		<td mat-cell *matCellDef="let row" [attr.colspan]="columns().length">
			<div class="element-detail-wrapper" [class.element-detail-wrapper-expanded]="isExpanded(row)">
				<div class="element-detail">
					<div class="card">
						<div class="card-header">
							<div class="thumb">
								@if (row.imageUrl) {
								<img
									[src]="row.imageUrl"
									alt="{{ row.plantType }} {{ row.variety }}"
									(click)="openImage(row.imageUrl!, row.plantType + ' ' + (row.variety || ''))"
								/>
								} @else {
								<div class="thumb-placeholder" aria-label="Ingen bild">
									<mat-icon>yard</mat-icon>
								</div>
								}
							</div>

							<div class="about">
								<div class="title-line">
									<div class="kicker">
										<strong>{{ row.plantType || '—' }}</strong>
										<span class="muted"> · </span>
										<span>{{ nameOf(row) || '—' }}</span>
									</div>

									<!-- Lättskött-skala -->
									<!-- Betyg -->
									@if (row.grade) {
									<span
										class="grade-badge"
										[class]="gradeClass(row.grade)"
										[matTooltip]="'Betyg: ' + gradeLabel(row.grade) + ' av ' + maxGrade"
										aria-label="Betyg: {{ gradeLabel(row.grade) }} av {{ maxGrade }}"
									>
										<!-- Material Symbols (siffror) -->
										<mat-icon class="grade-icon">{{ gradeIcon(row.grade) }}</mat-icon>
									</span>
									}
								</div>

								@if (row.description) {
								<p class="desc">{{ row.description }}</p>
								}
							</div>
						</div>

						<!-- Nedre rutnät: hårddata (2 kolumner) -->
						<div class="facts">
							@for (f of factRows(row); track f.label) {
							<div
								class="fact"
								[matTooltip]="f.hint || ''"
								[matTooltipDisabled]="!f.hint"
								matTooltipPosition="above"
								matTooltipShowDelay="250"
							>
								<div class="label">
									<mat-icon>{{ f.icon }}</mat-icon>
								</div>

								<div class="value">
									{{ f.value }}
								</div>
							</div>
							}
						</div>
					</div>
				</div>
			</div>
		</td>
	</ng-container>

	<!-- Header/rader utan expand-kolumn -->
	<tr mat-header-row *matHeaderRowDef="columns()"></tr>

	<tr
		mat-row
		*matRowDef="let row; columns: columns()"
		class="expandable-row"
		[class.row-expanded]="isExpanded(row)"
		(click)="toggle(row)"
		(keydown.enter)="toggle(row)"
		(keydown.space)="toggle(row)"
		role="button"
		tabindex="0"
	></tr>

	<tr mat-row *matRowDef="let _; columns: ['expandedDetail']" class="detail-row"></tr>
</table>
